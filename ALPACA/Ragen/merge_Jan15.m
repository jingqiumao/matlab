% H1	15:37	16:38	15-Jan
% H2	16:38	17:38	
% H3	17:40	18:38	
% H4	18:38	19:39	
% H5	19:39	20:39	
% H6	20:39	21:39	
% H7	21:39	22:39	
% H8	22:39	23:40	
% H9	23:40	0:40	16-Jan
% H10	0:40	1:40	
% H11	1:40	2:40	
% H12	2:40	3:41	
% H13	3:41	4:41	
% H14	4:41	5:41	
% H15	5:41	6:42	
% H16	6:42	7:42	
% H17	7:42	8:42	
% H18	8:42	9:43	
% H19	9:43	10:43	
% H20	10:57	11:57	
% H21	11:57	12:57	
% H22	12:57	13:57	
% H23	13:57	14:58	
% H24	14:58	15:58	
% H25	15:58	16:58	
% H26	16:58	17:59	
% H27	17:59	18:59	
% H28	18:59	19:59	
% H29	19:59	20:59	
% H30	20:59	22:00	

set(0,'defaultaxesfontsize',14);
set(0,'defaulttextfontsize',14);
set(0,'defaultlinelinewidth',4);

Na_ICPMS=[3.749402264
-1.474082658
5.200070853
-18.33238435
-11.23594343
-4.145636982
-6.955754609
-9.152719943
-6.767791446
9.593401508
-10.41968476
-15.99976303
NaN
-15.41517957
-1.234140675
-10.24345288
-16.02922014
2.663042958
-12.27804704
10.3637139
-7.413952915
-10.28113846
-11.16580027
-9.393475118
-13.48353031
NaN
NaN
-6.474188011
68.58650438];

Na_IC=[17.97596145
7.372142148
4.961504685
-0.264770186
3.640849207
7.352609857
2.61560047
4.697947933
2.269182357
10.58353701
-0.525324952
-0.214591887
3.675940502
0.0
8.462212069
0.563034546
0.0
10.1813867
0.010104438
20.32346117
0.316850008
3.848166363
-0.833697716
0.88129811
19.80402717
12.17871881
69.39976986
9.510873625
80.46543541];

Mg_ICPMS=[4.592739751
3.515077123
3.87265744
0.223444919
2.501672698
3.438592565
2.413987011
2.629276614
3.348656483
3.400427092
0.850947453
-0.115373295
NaN
-0.101197493
3.502666816
2.488309615
0.318127387
3.700693201
0.903560495
3.649948253
4.67561627
3.553911189
1.006757366
2.372865327
0.393776052
NaN
NaN
2.68635478
3.702029865];

Mg_IC=[1.758772233
1.522640009
0.943962578
4.312120253
-0.604569249
3.427373754
0.900221561
3.053683021
0.605126747
2.651595143
0.0
0.0
0.910837372
-0.16835314
-1.137127213
0.0
0.0
3.349076469
-0.484895992
0.165782591
-0.286082882
-0.060442418
0.0
-0.75954851
4.239482339
3.329549081
6.128488577
1.537882654
3.376621397]

K_ICPMS=[15.01383085
3.212274415
11.49970954
-27.31119089
-3.598746215
19.77051675
7.494098268
-2.432160957
5.255821443
26.73213903
-7.074792026
-20.71387872
NaN
-18.53720536
10.46419871
0.78519024
-22.8144908
14.0246857
-11.52903101
49.59755134
12.16499161
0.84762958
-18.82532471
-3.360673079
-14.36776003
NaN
NaN
7.38890171
110.1467133];

K_IC=[46.09322356
16.08188082
18.1952061
-5.785587205
17.87365306
23.93196219
17.02734058
17.84515974
14.10288624
38.78749773
4.960900264
0.124847761
20.12111184
-8.235290934
12.47185677
9.491769076
0.0
20.62373505
4.606412568
63.44725635
13.32478211
13.95810428
-2.977049231
7.085681273
75.028795
62.54192889
255.9989096
40.64046798
177.1484215];


Ca_ICPMS=[19.08589469
14.41841668
106.2926022
2.942896201
10.30708194
9.500704088
5.810921938
3.63800907
22.05158499
16.76077798
5.238826035
2.282296741
NaN
1.693270052
17.46169857
4.052373903
-2.209695501
33.42171821
2.398640044
33.88004251
53.52554531
8.465841979
18.38257498
11.17148003
15.23972378
NaN
NaN
10.92919654
128.3715034];

Ca_IC=[3.932486342
9.615182002
22.77701365
16.71120471
0.0
2.314577867
0.0
0.0
0.0
4.027345004
0.0
0.0
0.0
0.0
0.0
0.0
0.0
0.0
0.0
8.124423986
9.258772139
0.0
0.0
0.0
2.486914559
7.753622356
39.05999758
0.0
93.63768175];

Mn_ICPMS=[0.023597527
-0.000734922
0.043849206
-0.07024226
0.02008581
-0.039949484
0.008863762
-0.057621203
-0.006308313
0.010625545
-0.068059934
-0.050468555
NaN
-0.058085625
0.012797798
0.013623155
-0.014022247
0.031978552
0.011456178
0.122370981
0.107397666
0.082011779
-0.005499193
0.061765809
-0.010014405
NaN
NaN
0.004710841
-0.001682092];
    
Fe_ICPMS=[0.8078822
0.400562716
0.673241657
0.44269867
-0.054720297
-0.00026797
0.623193839
0.776401408
0.135193182
0.301405567
0.07709018
0.575952222
NaN
-0.000291138
0.415980226
0.389406207
0.960477945
0.538171185
0.445172703
0.285156168
0.348997793
0.250778546
0.174988948
0.296383988
0.447657171
NaN
NaN
-0.166077386
0.970553664];

Cu_ICPMS=[NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN
    NaN];

Zn_ICPMS=[8.48204552
4.749451353
19.76853155
2.790440809
2.257865102
2.442928984
2.425261485
1.317055689
3.513847952
3.231015855
1.458058819
1.444722295
NaN
1.107277499
3.654246046
2.376965415
1.914039369
6.9916556
5.200067518
5.536063329
3.104818272
3.231331534
3.057946022
1.433712976
2.3908642
NaN
NaN
1.88815722
1.966600939];

corr_fac=[0.971162867;
0.969737435;
0.98750537;
1.168501157;
1.002192813;
0.992915615;
0.940595861;
0.979345914;
0.96969556;
0.974569271;
0.9869226;
0.975399279;
0.975399279;
0.988254524;
1.047328957;
1.011643768;
1.020458532;
1.0104553;
1.033591967;
1.020177549;
1.042684888;
1.042494821;
0.988368232;
1.020083922;
1.017959678;
1.017959678;
1.017959678;
1.011230895;
1.037476109];

sulfate= [314.1237332
433.338495
370.0165358
287.7615793
154.515644
123.7952647
300.198859
156.4766674
144.6359147
169.970375
144.4476987
135.8808946
304.9679912
292.3390235
208.8730308
137.0038637
369.879079
443.8814485
482.6535173
274.4822057
122.4629769
149.5585568
68.00717177
95.55732363
191.3670661
188.4907533
96.57979773
53.01564511
141.6544212];

nitrate=[131.7783166
25.94492353
6.675531915
3.034421142
0.0
0.0
0.0
0.0
0.0
10.09315002
NaN
0.0
13.64424016
-7.274818402
0.0
0.0
0.0
2.872340426
-7.362166136
92.19248904
0.0
-2.015423952
0.0
0.0
19.34676776
0.0
49.05424363
0.0
562.2739955];

chloride=[11.20796058
3.200134102
0.0
0.0
0.0
0.0
0.0
0.0
0.0
6.394894922
0.0
0.0
0.0
0.0
1.622916707
0.0
0.0
8.303298151
0.0
27.27819078
0.0
0.0
0.0
0.0
30.29018742
16.8509147
146.0444274
2.570962436
73.74968498];

ammonium=[21.73485718
86.73077101
54.14506045
9.674434836
-4.007292122
-1.815780811
5.157211125
-0.526917919
-3.218007821
0.0
-3.567511716
-1.554234201
31.05522319
27.21936552
-1.213531289
-2.611196023
49.67385576
30.42951566
75.27332566
10.36771624
-3.849822602
0.0
-3.573279021
-3.318644504
-1.762782151
-3.597727448
0.0
-3.029902621
0.0];

Sr=[0.118628673;
0.08906189;
0.096447869;
0.043639217;
0.044037277;
0.042251157;
0.061839835;
0.056074582;
0.048090065;
0.726097294;
1.258403076;
0.485438778;
0.249737016;
0.188095354;
0.372997085;
0.129072985;
0.079100024;
0.073111039;
0.056837555;
0.06366565;
0.069490317;
0.035608054;
0.034605714;
0.11509229;
0.580483809;
1.169001162;
0.074991944;
0.046133057;
0.156301339];

%provided by ragen
%Jan *0.0172./0.672
%Feb *0.014./0.76266
sulfate_conc=sulfate.*0.0172./0.672;
nitrate_conc=nitrate.*0.0172./0.672;
ammonium_conc=ammonium.*0.0172./0.672;
chloride_conc=chloride.*0.0172./0.672;
K_ICPMS_conc=K_ICPMS.*0.0172./0.672;
Mg_ICPMS_conc=Mg_ICPMS.*0.0172./0.672;
Na_ICPMS_conc=Na_ICPMS.*0.0172./0.672;
Fe_ICPMS_conc=Fe_ICPMS.*0.0172./0.672;
Cu_ICPMS_conc=Cu_ICPMS.*0.0172./0.672;
Ca_ICPMS_conc=Ca_ICPMS.*0.0172./0.672;
Zn_ICPMS_conc=Zn_ICPMS.*0.0172./0.672;
Mn_ICPMS_conc=Mn_ICPMS.*0.0172./0.672;
Ca_IC_conc=Ca_IC.*0.0172./0.672;
K_IC_conc=K_IC.*0.0172./0.672;
Mg_IC_conc=Mg_IC.*0.0172./0.672;
Na_IC_conc=Na_IC.*0.0172./0.672;


doy=(16/24):(1/24):(44/24);%only first 29 points were used

doy=doy+julian('0115')+365;

load NCOREdata.mat
%here is to find the matching DEC data
delta_a = 1/24;
for i=1:length(doy)
      k=find((CO_time<=doy(i)+delta_a/2) & (CO_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(CO(k))));
            if isempty(kk)
               CO_new(i)=NaN;
            else
               CO_new(i)=mean(CO(k(kk)));
            end
        else
            CO_new(i)=NaN;
      end
      
      k=find((SO2_time<=doy(i)+delta_a/2) & (SO2_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(SO2(k))));
            if isempty(kk)
               SO2_new(i)=NaN;
            else
               SO2_new(i)=mean(SO2(k(kk)));
            end
        else
            SO2_new(i)=NaN;
      end
      
      k=find((O3_time<=doy(i)+delta_a/2) & (O3_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(O3(k))));
            if isempty(kk)
               O3_new(i)=NaN;
            else
               O3_new(i)=mean(O3(k(kk)));
            end
        else
            O3_new(i)=NaN;
      end
      
      k=find((NO2_time<=doy(i)+delta_a/2) & (NO2_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(NO2(k))));
            if isempty(kk)
               NO2_new(i)=NaN;
            else
               NO2_new(i)=mean(NO2(k(kk)));
            end
        else
            NO2_new(i)=NaN;
      end
      
      k=find((NOa_time<=doy(i)+delta_a/2) & (NOa_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(NOa(k))));
            if isempty(kk)
               NOa_new(i)=NaN;
            else
               NOa_new(i)=mean(NOa(k(kk)));
            end
        else
            NOa_new(i)=NaN;
      end
      
      k=find((NOb_time<=doy(i)+delta_a/2) & (NOb_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(NOb(k))));
            if isempty(kk)
               NOb_new(i)=NaN;
            else
               NOb_new(i)=mean(NOb(k(kk)));
            end
        else
            NOb_new(i)=NaN;
      end
      
      
      k=find((NOx_time<=doy(i)+delta_a/2) & (NOx_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(NOx(k))));
            if isempty(kk)
               NOx_new(i)=NaN;
            else
               NOx_new(i)=mean(NOx(k(kk)));
            end
        else
            NOx_new(i)=NaN;
      end
      
      k=find((NOy_time<=doy(i)+delta_a/2) & (NOy_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(NOy(k))));
            if isempty(kk)
               NOy_new(i)=NaN;
            else
               NOy_new(i)=mean(NOy(k(kk)));
            end
        else
            NOy_new(i)=NaN;
      end
      
      k=find((t3m_time<=doy(i)+delta_a/2) & (t3m_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(t3m(k))));
            if isempty(kk)
               t3m_new(i)=NaN;
            else
               t3m_new(i)=mean(t3m(k(kk)));
            end
        else
            t3m_new(i)=NaN;
      end
      
      k=find((rh_time<=doy(i)+delta_a/2) & (rh_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(rh(k))));
            if isempty(kk)
               rh_new(i)=NaN;
            else
               rh_new(i)=mean(t3m(k(kk)));
            end
        else
            rh_new(i)=NaN;
      end
      
      k=find((pm25_time<=doy(i)+delta_a/2) & (pm25_time>=doy(i)-delta_a/2));
      if ~isempty(k)
            kk=find(~(isnan(pm25(k))));
            if isempty(kk)
               pm25_new(i)=NaN;
            else
               pm25_new(i)=mean(pm25(k(kk)));
            end
        else
            pm25_new(i)=NaN;
      end
end


subplot (4,5,1)
plot(doy-380,pm25_new,'r.-')
title('PM2.5 (ug/m3)');
legend ('PM2.5');
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5,2)
plot(doy-380, NO2_new,'r.-')
title('NO2 (ppb)')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4,5,3)
plot(doy-380, O3_new,'r.-')
title('O3 (ppb)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,4)
plot(doy-380, NOa_new,'r.-')
title('NO a (ppb)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,5)
plot(doy-380, Sr,'k')
title('Strontium ')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);


subplot(4,5,6)
plot(doy-380, NOy_new,'r.-')
title('NOy (ppb)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,7)
plot(doy-380, NOx_new./NOy_new,'r.-')
title('NOx/NOy ratio')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,8)
plot(doy-380, SO2_new,'r.-')
title('SO2 (ppb)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,9)
plot(doy-380, t3m_new,'r.-')
title('Temp(C)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);

subplot(4,5,10)
plot(doy-380, CO_new,'r.-')
title('CO (ppm)')
set(gca,'XTick',[0.5 1 1.5 2 2.5],'XTickLabel',['12pm';'12am';'12pm';'12am';'12pm']);


subplot(4, 5, 11)
plot(doy-380, K_ICPMS_conc, doy-380, K_IC_conc, 'k')
title('K')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 12)
plot(doy-380,Mg_ICPMS_conc, doy-380, Mg_IC_conc, 'k')
title('Mg')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 13)
plot(doy-380,Na_ICPMS_conc,doy-380,Na_IC_conc,'k') 
title('Na')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 14)
plot(doy-380,Fe_ICPMS_conc.*corr_fac)
title('Fe')
set(gca,'XTick',[0 0.5 1 1.5 25],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 15)
plot(doy-380,Cu_ICPMS_conc.*corr_fac)
title('Cu')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);


subplot(4, 5, 16)
% plot(doy-380,Mn_ICPMS.*corr_fac)
% title('Mn')
% set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 17)
plot(doy-380,Ca_ICPMS,doy-380,Ca_IC,'k') 
title('Ca')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 18)
plot(doy-380,nitrate_conc, 'k')
title('Nitrate')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);


subplot(4, 5, 19)
plot(doy-380,sulfate_conc, 'k')
title('Sulfate')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

subplot(4, 5, 20)
plot(doy-380,ammonium_conc, 'k')
title('Ammonium')
set(gca,'XTick',[0 0.5 1 1.5 2],'XTickLabel',['12am';'12pm';'12am';'12pm']);

sgtitle('Jan 15-16');

figure
cation=(fill_NaN(Na_IC)./23+fill_NaN(Mg_IC.*2)./24+ fill_NaN(K_IC)./39+ fill_NaN(Ca_IC.*2)./40 +fill_NaN(ammonium./18));
anion=sulfate.*2./96+nitrate./62 + chloride./35;
scatter(anion, cation,140, sulfate, 'filled');grid;colorbar;
ylim([0 20])
hold on;
plot(0:1:10,0:1:10,'--');
plot(0:1:10,0:2:20,'--');
plot(0:1:10,0:0.5:5,'--');

figure
scatter(pm25_new,SO2_new, 30,t3m_new,'filled'); grid;colorbar;title('Jan');ylabel('SO2');xlabel('PM2.5');

function julianday=julian(dateinput)
%dateinput got to be like ymmdd.
        %year=str2num(dateinput(1))+2000;
                month=str2num(dateinput(1:2));
                day=str2num(dateinput(3:4));
                switch month
                        case 1
                daynum = 0;
                        case 2
                            daynum = 31;
                        case 3
                            daynum = 59;
                        case 4
                            daynum = 90;
                        case 5
                            daynum = 120;
                        case 6
                            daynum = 151;
            case 7
                            daynum = 181;
                        case 8
                            daynum = 212;
                        case 9
                            daynum = 243;
                        case 10
                            daynum = 273;
                        case 11
                            daynum = 304;
                        case 12
                            daynum = 334;
                end
%                 if rem(year,4) == 0 && month > 2
%                         daynum = daynum+1;
%                 end
                julianday = daynum+day;
end
